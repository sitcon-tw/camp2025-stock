# 📊 掛單清單分頁功能說明

## 🎯 功能概述

已為 `/orders` 指令新增了完整的分頁功能，讓使用者可以瀏覽完整的股票訂單歷史記錄。

## 🚀 主要功能

### 📱 基本使用
- **指令**: `/orders` - 查看第1頁訂單
- **指定頁面**: `/orders 3` - 查看第3頁訂單

### 🔄 互動功能
- **⬅️ 上一頁** / **➡️ 下一頁** - 翻頁瀏覽
- **📄 目前頁面** - 顯示頁面資訊，點擊重新整理
- **🔄 重新整理** - 更新最新訂單狀態
- **📋 第一頁** / **📑 最後一頁** - 快速跳轉

### 📋 訂單分類顯示

#### 🔄 進行中的訂單
- **等待成交** - 尚未撮合的訂單
- **部分成交** - 已部分成交，等待剩餘數量
- **等待中(限制)** - 受到系統限制的訂單

#### 📈 歷史訂單
- **✅ 已成交** - 完全成交的訂單
- **❌ 已取消** - 被取消的訂單

### 📊 顯示資訊

每筆訂單顯示：
- **🟢/🔴** 買入/賣出標示
- **股數和價格** - 訂單詳細資訊
- **訂單類型** - 市價/限價單
- **時間戳記** - 下單時間 (月/日 時:分)
- **狀態說明** - 詳細的訂單狀態

### ⚙️ 分頁設定

- **每頁顯示**: 8筆訂單
- **總訂單數**: 最多100筆（可調整）
- **優先顯示**: 進行中訂單優先於歷史訂單
- **排序方式**: 按時間倒序（最新的在前）

## 💡 使用範例

### 基本查看
```
/orders
```
顯示第1頁的訂單清單，包含互動按鈕

### 指定頁面
```
/orders 5
```
直接跳轉到第5頁查看

### 訊息格式範例
```
📊 John 的股票訂單

🔄 進行中的訂單：
• 🟢 買入 100 股 @ 25 元 (限價) 12/08 14:30
  等待成交
• 🔴 賣出 50 股 (市價) 12/08 13:45
  部分成交 (30/50@26元)

📈 歷史訂單：
• 🟢 買入 200 股 @ 24 元 (限價) → 24元 12/07 16:20
  ✅ 已成交
• 🔴 賣出 100 股 @ 28 元 (限價) 12/07 15:10
  ❌ 已取消

第 1/3 頁 (共 20 筆訂單)

[⬅️ 上一頁] [📄 1/3] [➡️ 下一頁]
[🔄 重新整理] [📋 第一頁] [📑 最後一頁]
```

## 🛠️ 技術實現

### 核心功能
1. **分頁邏輯** - 計算總頁數和目前頁面範圍
2. **訂單分類** - 區分進行中和歷史訂單
3. **時間排序** - 按建立時間倒序顯示
4. **按鈕處理** - 響應分頁操作的 callback

### 錯誤處理
- **網路錯誤** - API 請求失敗時的提示
- **無效頁面** - 頁面超出範圍的保護
- **未註冊使用者** - 引導註冊的友善提示

### 效能優化
- **訊息編輯** - 分頁時編輯原訊息而非傳送新訊息
- **快取友善** - 每次請求最新資料確保準確性
- **按鈕重複點擊** - 防止重複操作的保護

## 🔧 設定選項

可在 `commands.py` 中調整的參數：
- `ORDERS_PER_PAGE = 8` - 每頁顯示訂單數
- `limit: 100` - 總抓取訂單數

## 📝 使用說明

1. **查看訂單**: 在 Telegram 中輸入 `/orders`
2. **翻頁瀏覽**: 點擊 ⬅️ 或 ➡️ 按鈕
3. **快速跳轉**: 使用第一頁/最後一頁按鈕
4. **重新整理**: 點擊重新整理按鈕獲取最新狀態
5. **指定頁面**: 輸入 `/orders [頁碼]` 直接跳轉

這個功能讓使用者能夠：
- 📋 完整瀏覽所有訂單歷史
- 🔄 即時查看訂單狀態更新
- 📱 友善的手機介面操作
- ⚡ 快速找到特定時間的訂單

## 🚀 未來擴展

可能的功能增強：
- 🔍 按狀態篩選訂單
- 📅 按日期範圍查詢
- 📊 訂單統計資訊
- 💾 匯出訂單記錄
- 🎯 訂單搜尋功能