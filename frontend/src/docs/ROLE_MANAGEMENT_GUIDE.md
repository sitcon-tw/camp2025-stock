# 👥 角色管理系統使用指南

## 📋 概述

本系統提供完整的角色管理功能，管理員可以將使用者從預設的「學員」角色提升為其他管理角色。

## 🎯 角色層級說明

### 👤 學員 (STUDENT)
- **預設角色**：所有新使用者的初始角色
- **基本權限**：
  - 查看個人資料
  - 進行股票交易
  - 轉帳點數

### 💰 點數管理員 (POINT_MANAGER)
- **管理權限**：可以發放點數給使用者
- **包含權限**：
  - 學員的所有權限
  - 發放點數 (`give_points`)
  - 查看所有使用者 (`view_all_users`)

### 📢 公告員 (ANNOUNCER)
- **公告權限**：可以發布系統公告
- **包含權限**：
  - 學員的所有權限
  - 發布公告 (`create_announcement`)
  - 查看所有使用者 (`view_all_users`)

### 🔧 管理員 (ADMIN)
- **完整權限**：擁有所有系統功能
- **包含權限**：
  - 前面所有角色的權限
  - 管理使用者 (`manage_users`)
  - 管理市場 (`manage_market`)
  - 系統管理 (`system_admin`)

## 🚀 使用方式

### 方法一：快速角色設定

1. **進入管理員介面**
   - 使用管理員帳號登入 `/admin`
   - 點擊「👥 角色管理」頁簽

2. **使用快速設定工具**
   ```
   🚀 快速角色設定
   ├─ 輸入使用者名稱或 ID
   ├─ 選擇目標角色
   └─ 點擊「設定為XXX」
   ```

3. **適用情境**
   - 初始系統設定
   - 快速提升管理員
   - 緊急授權

### 方法二：完整角色管理

1. **使用者列表管理**
   - 查看所有使用者和當前角色
   - 搜尋特定使用者
   - 篩選特定角色的使用者

2. **詳細角色變更**
   - 點擊使用者列表中的「變更角色」
   - 選擇新角色並填寫變更原因
   - 確認變更

## 📝 操作流程範例

### 情境：將學員提升為點數管理員

1. **確認使用者已註冊**
   ```
   確保目標使用者已通過 Telegram 完成註冊
   ```

2. **快速設定方式**
   ```
   進入管理員介面 → 角色管理
   輸入使用者名稱：「張三」
   選擇角色：「點數管理員」
   點擊：「設定為點數管理員」
   ```

3. **完整管理方式**
   ```
   進入角色管理 → 搜尋「張三」
   點擊「變更角色」→ 選擇「點數管理員」
   填寫原因：「負責活動點數發放」
   確認變更
   ```

4. **驗證變更結果**
   ```
   使用者重新登入後即可使用新權限
   在使用者列表中確認角色已更新
   ```

## 🔒 安全注意事項

### 權限原則
- **最小權限原則**：只給予必要的權限
- **角色分離**：不同職責使用不同角色
- **定期審查**：定期檢查使用者角色是否適當

### 管理建議
- **謹慎提升管理員**：管理員權限包含危險操作
- **記錄變更原因**：便於日後追蹤和審計
- **多人驗證**：重要角色變更建議多人確認

## 🛠️ 故障排除

### 常見問題

#### Q: 使用者找不到或設定失敗
**A: 檢查以下項目**
- 確認使用者已完成 Telegram 註冊
- 檢查使用者名稱拼寫是否正確
- 確認使用者 ID 格式是否正確

#### Q: 角色變更後使用者沒有新權限
**A: 解決方法**
- 請使用者重新登入
- 確認後端權限檢查是否生效
- 檢查前端權限快取是否更新

#### Q: 無法存取角色管理功能
**A: 權限檢查**
- 確認當前使用者有 `manage_users` 權限
- 檢查是否為管理員角色
- 重新登入管理員介面

## 📊 最佳實踐

### 初始設定建議
1. **設定超級管理員**：先設定 1-2 個完整管理員
2. **分配專職角色**：設定專門的點數管理員和公告員
3. **保留學員角色**：大部分使用者保持學員身份

### 日常管理建議
1. **定期權限審查**：使用權限審查工具檢查配置
2. **權限文檔記錄**：記錄重要的權限變更
3. **應急管理員**：確保有備用管理員帳號

### 擴展考慮
1. **自動化審批**：考慮加入角色變更審批流程
2. **權限有效期**：考慮設定臨時權限的有效期
3. **審計日誌**：完整記錄所有權限變更操作

---

## 🎉 快速開始

### 新系統初始設定

1. **使用超級管理員登入**
2. **進入角色管理 → 快速設定**
3. **設定第一批管理員**：
   ```
   點數管理員：負責活動點數
   公告員：負責系統通知
   管理員：負責系統維護
   ```
4. **測試權限功能**：確認各角色功能正常
5. **完成初始設定**：系統即可正常運作

現在您的系統具備完整的角色管理功能！使用者可以從學員逐步提升至管理員，滿足不同的管理需求。